import{F as e}from"./Form-e7ce6a0e.js";import{as as s,at as o,R as a,d as t,b as r,m as i,u as l,q as n,r as p,C as m,I as d,K as c,o as u,h as j,w as g,e as f,t as v,a as h,g as w,B as b,k as x,E as _}from"./index-c922549f.js";import{E as R}from"./el-button-3322aa8d.js";import{E as y}from"./el-checkbox-8ac95930.js";import{u as k}from"./useForm-fd215ebe.js";import{a as C}from"./index-c103f8c9.js";import{u as P}from"./useValidator-bed50dac.js";import{_ as E}from"./_plugin-vue_export-helper-1b428a4d.js";import"./el-form-item-969f14b2.js";import"./constants-84857360.js";import"./use-form-common-props-cca367ba.js";import"./index-d069b56e.js";import"./el-row-b1864fd0.js";import"./el-tooltip-4ed993c7.js";import"./el-popper-777547bb.js";import"./isNil-1f22f7b0.js";import"./focus-trap-8b9664b6.js";import"./el-input-5992562e.js";import"./event-5568c9d8.js";import"./use-form-item-04993e5b.js";/* empty css               */import"./el-date-picker-62bfc5e6.js";import"./utils-627bb44a.js";import"./panel-time-pick-619bf4c7.js";import"./isEqual-9f3d5ffd.js";import"./index-90b96cbe.js";import"./debounce-6961f983.js";import"./localeData-97fc05ae.js";import"./index-1f214b38.js";import"./el-input-number-e9628339.js";import"./el-select-2d83cd87.js";import"./index-c4f3a95b.js";import"./index-075fce49.js";import"./scroll-2bae90a4.js";import"./validator-ea5284a6.js";import"./el-switch-6b1b0237.js";import"./el-time-picker-b9f9e86a.js";import"./el-divider-9c627bce.js";import"./InputPassword-4808e8fc.js";import"./style.css_vue_type_style_index_0_src_true_lang-f404ea13.js";import"./aria-ecee1d93.js";import"./tsxHelper-5aa3deb4.js";const{Axios:I,AxiosError:A,CanceledError:F,isCancel:D,CancelToken:V,VERSION:q,all:N,Cancel:H,isAxiosError:S,spread:T,toFormData:O,AxiosHeaders:U,HttpStatusCode:z,formToJSON:B,mergeConfig:K}=s,{wsCache:G}=o(),J={class:"text-2xl font-bold text-center w-[100%]"},L={class:"flex justify-between items-center w-[100%]"},M={class:"w-[100%]"},W=E(t({__name:"LoginForm",setup(s){const{required:t}=P(),E=r(),I=i(),{currentRoute:A,addRoute:F,push:D}=l(),{wsCache:V}=o(),{t:q}=x(),N={username:[t()],password:[t()]},H=n([{field:"title",colProps:{span:24}},{field:"username",label:q("login.username"),value:"admin",component:"Input",colProps:{span:24},componentProps:{placeholder:q("login.usernamePlaceholder")}},{field:"password",label:q("login.password"),value:"admin",component:"InputPassword",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:q("login.passwordPlaceholder")}},{field:"tool",colProps:{span:24}},{field:"login",colProps:{span:24}},{field:"otherIcon",colProps:{span:24}}]),T=p(!1),{register:O,elFormRef:U,methods:z}=k(),B=p(!1),K=p("");m((()=>A.value),(e=>{var s;K.value=null==(s=null==e?void 0:e.query)?void 0:s.redirect}),{immediate:!0});const W=async()=>{const e=h(U);await(null==e?void 0:e.validate((async e=>{var s;if(e){B.value=!0;const{getFormData:e}=z,t=await e();try{await(async e=>{const s=await a.post({url:"/api/users/login/",data:e});return G.set("accessToken",s.access_token),s})(t);const e=await a.get({url:"/api/users/self/"});e&&(V.set(E.getUserInfo,e),E.getDynamicRouter?X():(await I.generateRoutes("none").catch((()=>{})),I.getAddRouters.forEach((e=>{F(e)})),I.setIsAddRouters(!0),D({path:K.value||I.addRouters[0].path})))}catch(o){S(o)&&_.error(null==(s=o.response)?void 0:s.data.error_description)}finally{B.value=!1}}})))},X=async()=>{const{getFormData:e}=z,s={roleName:(await e()).username},a=await C(s);if(a){const{wsCache:e}=o(),s=a.data||[];e.set("roleRouters",s),await I.generateRoutes("test",s).catch((()=>{})),I.getAddRouters.forEach((e=>{F(e)})),I.setIsAddRouters(!0),D({path:K.value||I.addRouters[0].path})}};return(s,o)=>{const a=d("loading");return c((u(),j(h(e),{schema:H,rules:N,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:h(O)},{title:g((()=>[f("h2",J,v(h(q)("login.login")),1)])),tool:g((()=>[f("div",L,[w(h(y),{modelValue:T.value,"onUpdate:modelValue":o[0]||(o[0]=e=>T.value=e),label:h(q)("login.remember"),size:"small",disabled:B.value},null,8,["modelValue","label","disabled"])])])),login:g((()=>[f("div",M,[w(h(R),{loading:B.value,type:"primary",class:"w-[100%]",onClick:W},{default:g((()=>[b(v(h(q)("login.login")),1)])),_:1},8,["loading"])])])),_:1},8,["schema","onRegister"])),[[a,B.value]])}}}),[["__scopeId","data-v-1579909b"]]);export{W as default};
