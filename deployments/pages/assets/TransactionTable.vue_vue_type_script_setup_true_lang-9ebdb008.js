import{d as e,r as a,v as t,a as l,C as o,z as n,H as c,I as r,o as s,h as i,w as u,g as m,O as d,B as p,t as f,K as g,c as y,e as _,L as b,P as w,Q as v,x,k,E as j}from"./index-c922549f.js";import{a as h,E as C}from"./el-button-3322aa8d.js";/* empty css                        */import{E as U}from"./el-card-a447f2d0.js";import{a as V,E}from"./el-row-b1864fd0.js";import{E as S}from"./el-date-picker-62bfc5e6.js";import"./el-input-5992562e.js";import{E as T}from"./el-popper-777547bb.js";import{E as z}from"./el-empty-3c90baab.js";import{E as B}from"./el-message-box-e080817e.js";import"./el-overlay-51fc3bc1.js";import{E as A,a as I}from"./el-select-2d83cd87.js";import{E as L}from"./el-pagination-952f169c.js";/* empty css               */import{E as D,a as O}from"./el-table-column-afd5a8b4.js";import"./el-checkbox-8ac95930.js";import"./el-tooltip-4ed993c7.js";import{p as W,q as K,j as M}from"./index-186e8914.js";import{_ as P}from"./TransactionCategorySelect.vue_vue_type_script_setup_true_lang-b4528ece.js";const q={key:0},F={key:1},G={style:{"font-size":"smaller"}},H=e({__name:"TransactionTable",props:{refreshVersion:{default:0},clubUuid:{default:""},accountUuid:{default:""}},emits:["create","edit","export","show-statistic"],setup(e,{emit:H}){const N=e,{t:Q}=k(),X=a([]),Z=a(0),$=a(!1),J=a(""),R=a({category:"",offset:0,limit:30}),Y=a(""),ee=t({get(){const e=l(R);return e.offset/e.limit+1},set(e){const a=l(R);a.offset=(e-1)*a.limit}}),ae=t({get:()=>l(R).limit,set(e){l(R).limit=e}}),te=()=>{const e={club:N.clubUuid,account:N.accountUuid,...l(R)};if(l(J)){const a=l(J)[0],t=l(J)[1];e.transact_time_gte=a.toISOString(),e.transact_time_lt=t.toISOString()}return l(Y)&&("income"===l(Y)?e.transact_amount_gte=0:"expenditure"===l(Y)&&(e.transact_amount_lt=0)),e},le=async()=>{try{$.value=!0;const e=await W(te());Z.value=e.count||0,X.value=e.results}catch(e){Z.value=0,X.value=[]}finally{$.value=!1}};return o((()=>N.refreshVersion),(async()=>{await le()})),o((()=>N.accountUuid),(async()=>{await le()})),o((()=>N.clubUuid),(async()=>{await le()})),n((()=>{le()})),(e,a)=>{const t=c("Icon"),o=r("loading");return s(),i(l(V),null,{default:u((()=>[m(l(E),{span:24},{default:u((()=>[N.clubUuid&&N.accountUuid?(s(),i(l(U),{key:1,"body-style":"padding: 0"},{header:u((()=>[m(l(V),null,{default:u((()=>[d(e.$slots,"filter"),m(P,{modelValue:R.value.category,"onUpdate:modelValue":a[0]||(a[0]=e=>R.value.category=e),"club-uuid":N.clubUuid,style:{"margin-right":"5px"},clearable:""},null,8,["modelValue","club-uuid"]),m(l(A),{modelValue:Y.value,"onUpdate:modelValue":a[1]||(a[1]=e=>Y.value=e),clearable:""},{default:u((()=>[m(l(I),{label:l(Q)("common.income"),value:"income"},null,8,["label"]),m(l(I),{label:l(Q)("common.expenditure"),value:"expenditure"},null,8,["label"])])),_:1},8,["modelValue"])])),_:3}),m(l(V),{justify:"start",style:{"margin-top":"5px"}},{default:u((()=>[m(l(S),{modelValue:J.value,"onUpdate:modelValue":a[2]||(a[2]=e=>J.value=e),type:"datetimerange",style:{"margin-right":"5px"}},null,8,["modelValue"]),m(l(h),null,{default:u((()=>[m(l(C),{type:"primary",onClick:a[3]||(a[3]=e=>{H("create")})},{default:u((()=>[p(f(l(Q)("exampleDemo.add")),1)])),_:1}),m(l(C),{onClick:a[4]||(a[4]=e=>le())},{default:u((()=>[m(l(T),{content:l(Q)("router.search"),placement:"top"},{default:u((()=>[m(t,{icon:"ep:search"})])),_:1},8,["content"])])),_:1}),m(l(C),{onClick:a[5]||(a[5]=e=>(()=>{const e=te();e.offset=void 0,e.limit=void 0,H("export",e)})())},{default:u((()=>[m(l(T),{content:l(Q)("common.export"),placement:"top"},{default:u((()=>[m(t,{icon:"material-symbols:download"})])),_:1},8,["content"])])),_:1}),m(l(C),{onClick:a[6]||(a[6]=e=>(()=>{const e=te();e.offset=void 0,e.limit=void 0,H("show-statistic",e)})())},{default:u((()=>[m(l(T),{content:l(Q)("common.charts"),placement:"top"},{default:u((()=>[m(t,{icon:"material-symbols:bar-chart"})])),_:1},8,["content"])])),_:1})])),_:1})])),_:1})])),default:u((()=>[g((s(),i(l(D),{data:X.value},{default:u((()=>[m(l(O),{label:l(Q)("accounting.transactionAmount"),align:"center"},{default:u((({row:e})=>[e.transact_amount>=0?(s(),y("span",q,f(e.transact_amount),1)):(s(),y("span",F,f(-e.transact_amount),1)),e.transact_amount>=0?(s(),i(t,{key:2,icon:"material-symbols:arrow-upward",style:{color:"#67c23a"}})):(s(),i(t,{key:3,icon:"material-symbols:arrow-downward",style:{color:"red"}}))])),_:1},8,["label"]),m(l(O),{label:l(Q)("accounting.transactionTime"),align:"center"},{default:u((({row:e})=>[_("span",G,f(new Date(e.transact_time).toLocaleString()),1)])),_:1},8,["label"]),m(l(O),{label:l(Q)("accounting.transactionCategory"),align:"center",prop:"category_name"},null,8,["label"]),m(l(O),{label:l(Q)("common.description"),align:"center",prop:"description"},null,8,["label"]),m(l(O),{label:l(Q)("accounting.transactionAudited"),align:"center","min-width":"40"},{default:u((({row:e})=>[m(l(b),null,{default:u((()=>[e.transact_audited?(s(),i(l(w),{key:0})):(s(),i(l(v),{key:1,style:{cursor:"pointer",color:"goldenrod"},onClick:a=>(async e=>{try{await B.confirm(Q("accounting.transactionConfirmToAudit"),Q("common.delWarning"),{confirmButtonText:Q("common.ok"),cancelButtonText:Q("common.cancel"),type:"warning"})}catch(a){return}try{await M(e.uuid,{transact_audited:!0}),j({type:"success",message:Q("common.succeed")})}catch(a){j({type:"error",message:Q("common.failed")})}await le()})(e)},null,8,["onClick"]))])),_:2},1024)])),_:1},8,["label"]),m(l(O),{label:l(Q)("common.createdBy"),align:"center"},{default:u((({row:e})=>[m(l(V),null,{default:u((()=>[m(l(E),null,{default:u((()=>[p(f(e.created_by),1)])),_:2},1024)])),_:2},1024),m(l(V),null,{default:u((()=>[m(l(E),{style:{"font-size":"x-small"}},{default:u((()=>[p(f(new Date(e.created_time).toLocaleString()),1)])),_:2},1024)])),_:2},1024)])),_:1},8,["label"]),m(l(O),{label:l(Q)("common.action"),align:"center"},{default:u((({row:e})=>[m(l(h),null,{default:u((()=>[m(l(C),{onClick:a=>(e=>{H("edit",l(e))})(e)},{default:u((()=>[m(t,{icon:"ep:edit"})])),_:2},1032,["onClick"]),m(l(C),{type:"danger",disabled:e.transact_audited,onClick:a=>(async e=>{try{await B.confirm(Q("common.delMessage"),Q("common.delWarning"),{confirmButtonText:Q("common.ok"),cancelButtonText:Q("common.cancel"),type:"warning"})}catch(a){return}try{await K(e.uuid),j({type:"success",message:Q("common.delSuccess")})}catch(a){j({type:"error",message:Q("common.delFailed")})}await le()})(e)},{default:u((()=>[m(t,{icon:"ep:delete"})])),_:2},1032,["disabled","onClick"])])),_:2},1024)])),_:1},8,["label"])])),_:1},8,["data"])),[[o,$.value]]),m(l(L),{"current-page":l(ee),"onUpdate:currentPage":a[7]||(a[7]=e=>x(ee)?ee.value=e:null),"page-size":l(ae),"onUpdate:pageSize":a[8]||(a[8]=e=>x(ae)?ae.value=e:null),total:Z.value,layout:"prev, pager, next, jumper, sizes, total",style:{margin:"10px"},onSizeChange:a[9]||(a[9]=e=>le()),onCurrentChange:a[10]||(a[10]=e=>le())},null,8,["current-page","page-size","total"])])),_:3})):(s(),i(l(z),{key:0,description:"No Account Selected"}))])),_:3})])),_:3})}}});export{H as _};
