import{d as e,r as a,v as t,a as l,C as n,D as o,z as s,H as i,I as r,o as c,h as u,w as m,g as d,J as p,B as f,t as g,y,K as _,e as b,c as w,G as x,F as h,x as j,k,E as v}from"./index-c922549f.js";import{a as C,E}from"./el-button-3322aa8d.js";/* empty css                        */import{E as z}from"./el-card-a447f2d0.js";import{a as S,E as U}from"./el-row-b1864fd0.js";import{E as T}from"./el-input-5992562e.js";import{E as V}from"./el-message-box-e080817e.js";import"./el-overlay-51fc3bc1.js";import{E as B}from"./el-pagination-952f169c.js";/* empty css               */import"./el-select-2d83cd87.js";import{E as D}from"./el-popper-777547bb.js";import{E as K,a as $}from"./el-table-column-afd5a8b4.js";import"./el-checkbox-8ac95930.js";import"./el-tooltip-4ed993c7.js";import{l as F,d as I}from"./index-cbebeb66.js";import{E as L}from"./index-c4f3a95b.js";const M={style:{"white-space":"pre-wrap","word-break":"break-word"}},P=e({__name:"ParticipantTable",props:{refreshVersion:{default:0},excludeClubUuid:{default:""},isSelecting:{type:Boolean,default:!1}},emits:["create","edit","select","show-title"],setup(e,{emit:P}){const W=e,{t:G}=k(),H=a([]),J=a(0),R=a(!1),X=a({offset:0,limit:30,name_contains:""}),q=t({get(){const e=l(X);return e.offset/e.limit+1},set(e){const a=l(X);a.offset=(e-1)*a.limit}}),A=t({get:()=>l(X).limit,set(e){l(X).limit=e}}),N=async()=>{try{R.value=!0;const e={club_exclude:W.excludeClubUuid,...l(X)},a=await F(e);J.value=a.count||0,H.value=a.results}catch(e){J.value=0,H.value=[]}finally{R.value=!1}},O=e=>{P("select",l(e))};return n((()=>W.refreshVersion),(async()=>{await N()})),n((()=>W.excludeClubUuid),(async()=>{await N()})),o((()=>{N()})),s((()=>{N()})),(a,t)=>{const n=i("Icon"),o=r("loading");return c(),u(l(S),null,{default:m((()=>[d(l(U),{span:24},{default:m((()=>[d(l(z),{"body-style":"padding: 0"},{header:m((()=>[d(l(S),null,{default:m((()=>[d(l(T),{modelValue:X.value.name_contains,"onUpdate:modelValue":t[0]||(t[0]=e=>X.value.name_contains=e),placeholder:l(G)("common.name"),style:{width:"200px","margin-right":"5px"},clearable:"",onKeydown:t[1]||(t[1]=p((e=>N()),["enter"]))},null,8,["modelValue","placeholder"]),d(l(C),null,{default:m((()=>[e.isSelecting?y("",!0):(c(),u(l(E),{key:0,type:"primary",onClick:t[2]||(t[2]=e=>{P("create")})},{default:m((()=>[f(g(l(G)("exampleDemo.add")),1)])),_:1})),d(l(E),{onClick:t[3]||(t[3]=e=>N())},{default:m((()=>[d(l(D),{content:l(G)("router.search"),placement:"top"},{default:m((()=>[d(n,{icon:"ep:search"})])),_:1},8,["content"])])),_:1})])),_:1})])),_:1})])),default:m((()=>[_((c(),u(l(K),{data:H.value,onRowClick:O},{default:m((()=>[d(l($),{label:l(G)("common.name"),align:"center",prop:"name"},null,8,["label"]),d(l($),{label:l(G)("common.intro"),align:"center"},{default:m((({row:e})=>[b("span",M,g(e.intro),1)])),_:1},8,["label"]),d(l($),{label:l(G)("participants.participantTitle"),align:"center","min-width":50},{default:m((({row:e})=>[(c(!0),w(h,null,x(e.titles,(e=>(c(),u(l(S),{key:e.uuid,justify:"center"},{default:m((()=>[d(l(L),{type:"info",style:{"margin-top":"1px","margin-bottom":"1px"}},{default:m((()=>[f(g(e.level?`${e.alias||e.name}${e.level}`:`${e.alias||e.name}`),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["label"]),d(l($),{label:l(G)("configs.club"),align:"center","min-width":50},{default:m((({row:e})=>[(c(!0),w(h,null,x(e.clubs,(e=>(c(),u(l(S),{key:e.uuid,justify:"center"},{default:m((()=>[d(l(L),{type:"info",style:{"margin-top":"1px","margin-bottom":"1px"}},{default:m((()=>[f(g(e.alias||e.name),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["label"]),d(l($),{label:l(G)("common.createdBy"),align:"center"},{default:m((({row:e})=>[d(l(S),null,{default:m((()=>[d(l(U),null,{default:m((()=>[f(g(e.created_by),1)])),_:2},1024)])),_:2},1024),d(l(S),null,{default:m((()=>[d(l(U),{style:{"font-size":"x-small"}},{default:m((()=>[f(g(new Date(e.created_time).toLocaleString()),1)])),_:2},1024)])),_:2},1024)])),_:1},8,["label"]),e.isSelecting?y("",!0):(c(),u(l($),{key:0,label:l(G)("common.action"),align:"center"},{default:m((({row:e})=>[d(l(C),null,{default:m((()=>[d(l(E),{onClick:a=>(e=>{P("show-title",l(e))})(e)},{default:m((()=>[d(n,{icon:"material-symbols:badge-sharp"})])),_:2},1032,["onClick"]),d(l(E),{onClick:a=>(e=>{P("edit",l(e))})(e)},{default:m((()=>[d(n,{icon:"ep:edit"})])),_:2},1032,["onClick"]),d(l(E),{type:"danger",onClick:a=>(async e=>{try{await V.confirm(G("common.delMessage"),G("common.delWarning"),{confirmButtonText:G("common.ok"),cancelButtonText:G("common.cancel"),type:"warning"})}catch(a){return}try{await I(e.uuid),v({type:"success",message:G("common.delSuccess")})}catch(a){v({type:"error",message:G("common.delFailed")})}await N()})(e)},{default:m((()=>[d(n,{icon:"ep:delete"})])),_:2},1032,["onClick"])])),_:2},1024)])),_:1},8,["label"]))])),_:1},8,["data"])),[[o,R.value]]),d(l(B),{"current-page":l(q),"onUpdate:currentPage":t[4]||(t[4]=e=>j(q)?q.value=e:null),"page-size":l(A),"onUpdate:pageSize":t[5]||(t[5]=e=>j(A)?A.value=e:null),total:J.value,layout:"prev, pager, next, jumper, sizes, total",style:{margin:"10px"},onSizeChange:t[6]||(t[6]=e=>N()),onCurrentChange:t[7]||(t[7]=e=>N())},null,8,["current-page","page-size","total"])])),_:1})])),_:1})])),_:1})}}});export{P as _};
